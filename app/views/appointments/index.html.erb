<div class="container-fluid mt-3 px-4 d-flex flex-column" style="min-height: 100vh;">
  <h1 class="mb-3">Appointments</h1>
  <div class="mb-3">
    <%= link_to "New Appointment", new_appointment_path, class: "btn btn-primary" %>
  </div>

  <% if notice %>
    <div class="alert alert-success mb-3"><%= notice %></div>
  <% end %>

  <!-- Solo el calendario -->
  <div id="calendar" class="flex-grow-1" style="max-height: 80vh; overflow-y: auto;"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: '/appointments.json',
      editable: true,
      selectable: true,
      eventClick: function(info) {
        window.location.href = '/appointments/' + info.event.id;
      },
      eventDrop: function(info) {
        fetch('/appointments/' + info.event.id, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
          },
          body: JSON.stringify({
            date: info.event.start.toISOString().split('T')[0],
            time: info.event.start.toTimeString().split(' ')[0]
          })
        }).then(response => {
          if (!response.ok) {
            alert('Error al actualizar el turno. Intenta de nuevo.');
            calendar.refetchEvents();
          }
        });
      },
      select: function(info) {
        window.location.href = '<%= new_appointment_path %>?date=' + info.startStr;
      },
      eventContent: function(arg) {
        return { html: `<b>${arg.event.title}</b>` };
      },
      eventDidMount: function(info) {
        console.log('Evento cargado:', info.event);
      }
    });
    calendar.render();
  });
</script>

<style>
  /* Asegurar que el body no tenga márgenes ni desbordamiento */
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  /* Ajustar el contenedor para pantallas grandes */
  @media (min-width: 1200px) {
    .container-fluid {
      max-width: 95%;
    }
  }

  /* Hacer que los eventos sean más visibles */
  .fc-event {
    cursor: pointer;
    background-color: #007bff;
    color: white;
    border-radius: 4px;
    padding: 2px 5px;
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>